<html lang="en">
  <head>
    <title>Documentation - Smarkets Streaming API</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <h1><a href="">Smarkets Streaming API Documentation</a></h1>

    <div id="toc">
      <ul>
      {% for name in order %}
      <li><a href="#{{ name }}" class="type">{{ name }}</a></li>
      {% endfor %}
      </ul>
    </div>

    <div id="content">
      <p>
      To work with the Smarkets Streaming API you will need to:
      <ol class="steps">
        <li>
        Create a persistent TCP connection to <code>api-dev.corp.smarkets.com:3701</code>
        </li>
        <li>
        <a href="#encode">Encode</a>, <a href="#frame" class="type">frame</a> and send a <a href="#message" class="type">message</a> with a <a href="#login" class="type">login</a> <a href="#payload" class="type">payload</a> to obtain a <a href="#session" class="type">session</a>.
        </li>
        <li>
        Receive the resulting <a href="#login-response" class="type">login-response</a> sent to you from Smarkets, you now have an API <a href="#session" class="type">session</a>.
        </li>
        <li>
        Send, receive, and respond to <a href="#message">messages</a> with specific <a href="#payload" class="type">payloads</a> while maintaining and logging incoming and outgoing <a href="#seq" class="type">sequence</a> numbers for your <a href="#session" class="type">session</a>.         </li>
        <li>
        All messages should be processed in sequence and should never be processed out of order, except for <a href="#replay" class="type">replay</a> requests which should be handled immediately.
        </li>
        <li>
        If your application disconnects or gets disconnected - resume the <a href="#session" class="type">session</a> by reconnecting and issuing a <a href="#message" class="type">message</a> with the resuming <a href="#seq" class="type">sequence</a> numbers and a <a href="#login" class="type">login</a> payload with the <span class="field">session</span> field set.
        </li>
        <li>
        If a message is received with a <a href="#seq" class="type">sequence</a> greater than is expected a <a href="#replay" class="type">replay</a> message should be issued re-requesting the missing batch of messages.
        </li>
      </ol>
      </p>

      <p>
      <em>Note: the example messages and payloads in message passing tables on this page are psuedo-code and not code examples of any language.</em>
      </p>

      <h2 id="encode">Encoding Messages</h2>
      <p>
      All <a href="#frame">frames</a> are encoded into bytes before being <a href="#framing">framed</a> and sent. This will depend on the language you are using to communicate with the Smarkets server.
      </p>

      <h2 id="framing">Framing</h2>
      <p>

      </p>

      {% for pdef in piqdef %}
      {% with def=pdef.def %}
      {% if not def.name %}
      {% comment %}
      <div><strong>Error:</strong> {{ pdef }}</div>
      {% endcomment %}

      {% else %}
      <div class="def">
        <h3 id="{{ def.name }}">
          <span class="name">{{ def.name }}</span>
          <span class="piqi_type">{{ pdef.piqi_type }}</span>
          {% if pdef.piqi_type=="list" or pdef.piqi_type=="alias" %}
          {% type name=def.type.name %}
          {% endif %}
        </h4>

        {% ifequal pdef.piqi_type "record" %}
        <ul>
          {% for field in def.field %}
          <li>
          <span class="name">{% firstof field.name field.type.name %}</span>
          {% type name=field.type.name %}
          {% if field.default %}
          <span class="default">Default: {{ field.default.value }}</span>
          {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% endifequal %}

        {% if pdef.piqi_type == "variant" or pdef.piqi_type == "enum"  %}
        <ul>
          {% for option in def.option %}
          <li>
          <span class="name">{% firstof option.name option.type.name %}</span>
          {% if option.type %}
          {% type name=option.type.name %}
          {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% endif%}

        {% if pdef.description %}
        <div class="description">{{ pdef.description }}</div>
        {% endif %}

      </div>
      {% endif %}
      {% endwith %}
      {% endfor %}
    </div>

    </body>
  </html>
